"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[9456],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(a),c=r,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||i;return a?n.createElement(h,o(o({ref:t},d),{},{components:a})):n.createElement(h,o({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},444:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const i={id:"X700-series-PCI-e-NICs",title:"X700-series PCI-e NICs",tags:["Intel","Firmware","NIC","Update","i40","Driver","nvmupdate64e"],description:"Compile and update FW X710-series"},o=void 0,l={unversionedId:"networks/Intel/X700-series-PCI-e-NICs",id:"networks/Intel/X700-series-PCI-e-NICs",title:"X700-series PCI-e NICs",description:"Compile and update FW X710-series",source:"@site/docs/networks/Intel/X700-series-upd.md",sourceDirName:"networks/Intel",slug:"/networks/Intel/X700-series-PCI-e-NICs",permalink:"/docs/networks/Intel/X700-series-PCI-e-NICs",draft:!1,editUrl:"https://github.com/IgorKha/igorkha.github.io/tree/main/docs/networks/Intel/X700-series-upd.md",tags:[{label:"Intel",permalink:"/docs/tags/intel"},{label:"Firmware",permalink:"/docs/tags/firmware"},{label:"NIC",permalink:"/docs/tags/nic"},{label:"Update",permalink:"/docs/tags/update"},{label:"i40",permalink:"/docs/tags/i-40"},{label:"Driver",permalink:"/docs/tags/driver"},{label:"nvmupdate64e",permalink:"/docs/tags/nvmupdate-64-e"}],version:"current",frontMatter:{id:"X700-series-PCI-e-NICs",title:"X700-series PCI-e NICs",tags:["Intel","Firmware","NIC","Update","i40","Driver","nvmupdate64e"],description:"Compile and update FW X710-series"},sidebar:"tutorialSidebar",previous:{title:"intro",permalink:"/docs/networks/intro"},next:{title:"intro",permalink:"/docs/devops/intro"}},s={},p=[{value:"i40e Linux Base Driver",id:"i40e-linux-base-driver",level:2},{value:"Overview",id:"overview",level:3},{value:"Building and Installation",id:"building-and-installation",level:3},{value:"To manually build the driver",id:"to-manually-build-the-driver",level:3},{value:"Firmware update",id:"firmware-update",level:2},{value:"Update overview",id:"update-overview",level:3},{value:"Limitations and Prerequisites",id:"limitations-and-prerequisites",level:3},{value:"Firmware Recovery Mode",id:"firmware-recovery-mode",level:3},{value:"Updating Your NVM Using Interactive Mode",id:"updating-your-nvm-using-interactive-mode",level:3},{value:"Using a Script",id:"using-a-script",level:3}],d={toc:p},m="wrapper";function u(e){let{components:t,...a}=e;return(0,r.kt)(m,(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"i40e-linux-base-driver"},"i40e Linux Base Driver"),(0,r.kt)("h3",{id:"overview"},"Overview"),(0,r.kt)("p",null,"This driver supports kernel versions 2.6.32 and newer. However, some features may require a newer kernel version. The associated Virtual Function (VF) driver for this driver is iavf. The associated RDMA driver for this driver is irdma."),(0,r.kt)("p",null,"Driver information can be obtained using ethtool, lspci, and ip. Instructions on updating ethtool can be found in the section Additional Configurations later in this document."),(0,r.kt)("p",null,"This driver is only supported as a loadable module at this time. Intel is not supplying patches against the kernel source to allow for static linking of the drivers."),(0,r.kt)("p",null,"For questions related to hardware requirements, refer to the documentation supplied with your Intel adapter. All hardware requirements listed apply to use with Linux."),(0,r.kt)("p",null,"This driver supports XDP (Express Data Path) on kernel 4.14 and later and AF_XDP zero-copy on kernel 4.18 and later. Note that XDP is blocked for frame sizes larger than 3KB."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"1 Gb devices based on the Intel(R) Ethernet Network Connection X722 do\nnot support the following features:"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Data Center Bridging (DCB)"),(0,r.kt)("li",{parentName:"ul"},"QOS"),(0,r.kt)("li",{parentName:"ul"},"VMQ"),(0,r.kt)("li",{parentName:"ul"},"SR-IOV"),(0,r.kt)("li",{parentName:"ul"},"Task Encapsulation offload (VXLAN, NVGRE)"),(0,r.kt)("li",{parentName:"ul"},"Energy Efficient Ethernet (EEE)"),(0,r.kt)("li",{parentName:"ul"},"Auto-media detect"))),(0,r.kt)("h3",{id:"building-and-installation"},"Building and Installation"),(0,r.kt)("p",null,"Firstly need download ",(0,r.kt)("inlineCode",{parentName:"p"},"i40e-x.x.x.tar.gz")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.intel.com/content/www/us/en/download/18026/"},"Download Intel Network Adapter Driver for PCIe")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"More information can be found in the README file in archive ",(0,r.kt)("inlineCode",{parentName:"p"},"i40e-x.x.x.tar.gz"))),(0,r.kt)("h3",{id:"to-manually-build-the-driver"},"To manually build the driver"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Move the base driver tar file to the directory of your choice.\nFor example, use '/home/username/i40e' or '/usr/local/src/i40e'.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Untar/unzip the archive, where ",(0,r.kt)("inlineCode",{parentName:"p"},"<x.x.x>")," is the version number for the\ndriver tar file:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"tar zxf i40e-<x.x.x>.tar.gz\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Change to the driver src directory, where ",(0,r.kt)("inlineCode",{parentName:"p"},"<x.x.x>")," is the version number\nfor the driver tar:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd i40e-<x.x.x>/src/\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Compile the driver module:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"make install\n")),(0,r.kt)("p",{parentName:"li"},"The binary will be installed as:\n",(0,r.kt)("inlineCode",{parentName:"p"},"/lib/modules/<KERNEL VER>/updates/drivers/net/ethernet/intel/i40e/i40e.ko")),(0,r.kt)("p",{parentName:"li"},"The install location listed above is the default location. This may differ\nfor various Linux distributions."),(0,r.kt)("p",{parentName:"li"},"NOTE: To gather and display additional statistics, use the\nI40E_ADD_PROBES pre-processor macro:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"make CFLAGS_EXTRA=-DI40E_ADD_PROBES\n")),(0,r.kt)("p",{parentName:"li"},"Please note that this additional statistics gathering can impact\nperformance."),(0,r.kt)("admonition",{parentName:"li",type:"note"},(0,r.kt)("p",{parentName:"admonition"}," You may see warnings from depmod related to unknown RDMA symbols\nduring the make of the OOT base driver. These warnings are normal and\nappear because the in-tree RDMA driver will not work with the OOT base\ndriver. To address the issue, you need to install the latest OOT versions\nof the base and RDMA drivers."))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Load the module using the modprobe command."),(0,r.kt)("p",{parentName:"li"},"To check the version of the driver and then load it:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"modinfo i40e\nmodprobe i40e [parameter=port1_value,port2_value]\n")),(0,r.kt)("p",{parentName:"li"},"Alternately, make sure that any older i40e drivers are removed from the\nkernel before loading the new module:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rmmod i40e; modprobe i40e\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Assign an IP address to the interface by entering the following,\nwhere ",(0,r.kt)("inlineCode",{parentName:"p"},"<ethX>")," is the interface name that was shown in dmesg after modprobe:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ip address add <IP_address>/<netmask bits> dev <ethX>\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Verify that the interface works. Enter the following, where IP_address\nis the IP address for another machine on the same subnet as the interface\nthat is being tested:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ping <IP_address>\n")))),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"For certain distributions like (but not limited to) Red Hat Enterprise\nLinux 7 and Ubuntu, once the driver is installed, you may need to update the\ninitrd/initramfs file to prevent the OS loading old versions of the i40e driver."),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="For Red Hat distributions:"',title:'"For',Red:!0,Hat:!0,'distributions:"':!0},"dracut --force\n")),(0,r.kt)("pre",{parentName:"admonition"},(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="For Ubuntu:"',title:'"For','Ubuntu:"':!0},"update-initramfs -u\n"))),(0,r.kt)("h2",{id:"firmware-update"},"Firmware update"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.intel.com/content/www/us/en/download/18190/"},"NVM Update Package")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www-ssl.intel.com/content/www/us/en/embedded/products/networking/nvm-update-tool-quick-linux-usage-guide.html"},"Intel Ethernet NVM Update Tool Quick Usage Guide for Linux (PDF)")),(0,r.kt)("h3",{id:"update-overview"},"Update overview"),(0,r.kt)("p",null,"This package contains all the required files to update the NVM on the Intel(R) Ethernet adapters in your system. It contains the NVMUpdate utility, configuration file, updated NVM binaries, and required driver files."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},'Note: Some Intel(R) Ethernet Converged Network Adapter X710-T4 adapters may display the message "Image differences found at offset 0x7..." when performing an update using the 700 Series NVM Update Package. This behavior is expected. Updating the Option ROM on a device with Device ID 1586 is a two step process. The first update will change the Device ID to 1589. Reboot your system and run the update tool a second time to update the Option ROM for the new Device ID.')),(0,r.kt)("h3",{id:"limitations-and-prerequisites"},"Limitations and Prerequisites"),(0,r.kt)("p",null,"This package is intended to be used on Intel branded adapters. Please contact your OEM vendor for an appropriate package. In some cases this package may update an OEM device. This package only updates the NVM image for the device family listed on the package. Each Intel Ethernet product family has its own NVM Update Package."),(0,r.kt)("admonition",{title:"DO NOT",type:"danger"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"Power down your system during the NVM Update."),(0,r.kt)("li",{parentName:"ul"},"Remove the NIC before the NVM Update completes."),(0,r.kt)("li",{parentName:"ul"},"Interrupt the NVM Update in any other way.")),(0,r.kt)("p",{parentName:"admonition"},"Doing so may make your device unusable.")),(0,r.kt)("h3",{id:"firmware-recovery-mode"},"Firmware Recovery Mode"),(0,r.kt)("p",null,"When a device is in Firmware Recovery mode it will not pass traffic or allow any configuration; you can only attempt to recover the device's firmware. A device will enter Firmware Recovery mode if it detects a problem that requires the firmware to be reprogrammed."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},'Before starting the recovery process, make sure that your operating system, drivers, and tools have been installed properly. You must use the out-of-tree driver. Using the in-box or kernel driver may result in a "Cannot initialize port" warning.')),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"You must power cycle your system after using Recovery Mode to completely reset the firmware and hardware.")),(0,r.kt)("h3",{id:"updating-your-nvm-using-interactive-mode"},"Updating Your NVM Using Interactive Mode"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Extract the update package into a temporary folder.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Start the NVMUpdate utility by running the executable. For example, on an\nx64 Microsoft","*","  Windows","*","  system, type:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-text"},"nvmupdatew64e\n")),(0,r.kt)("p",{parentName:"li"}," On an x64 Linux* system, type:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-text"},"nvmupdate64e\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Follow the prompts to update the NVM image on the desired device."))),(0,r.kt)("h3",{id:"using-a-script"},"Using a Script"),(0,r.kt)("p",null,"You can use a script to perform an inventory of all the Intel Ethernet devices in the system or update the Intel Ethernet devices in the system."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Update script example:"',title:'"Update',script:!0,'example:"':!0},"nvmupdate64e -u -l -o results.xml -b -c nvmupdate.cfg\n")),(0,r.kt)("p",null,"This causes the NVMUpdate utility to check the installed Intel Ethernet devices\nagainst those contained in nvmupdate.cfg. If a device contains an NVM version\nolder than that specified in the config file, the utility will update the\ndevice's NVM. It will create an xml file containing the results of the update.\nNote that -b is optional. Specifying -b will create a backup of the current NVM\nimage(s). This may add about 30% to the tools execution time."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="Inventory script example:"',title:'"Inventory',script:!0,'example:"':!0},"nvmupdate64e -i -l -o inventory.xml\n")),(0,r.kt)("p",null,"This causes the NVMUpdate utility to perform an inventory of all the Intel\nEthernet devices in the system and creates an output file (called\ninventory.xml) of the results of the inventory."))}u.isMDXComponent=!0}}]);